import{r as t,p as v,l as I}from"./chunk-D52XG6IA-DVTnw_rV.js";import{g as w}from"./utils-CBmQbvEb.js";const i="admin",N="admin",f=t.createContext(void 0),U=({children:o})=>{const[s,c]=t.useState(null),A=v(),u=!!s,[g,r]=t.useState(!1);t.useEffect(()=>{const e=localStorage.getItem("authUser");e&&(JSON.parse(e),c(JSON.parse(e)));const a=localStorage.getItem("isAdmin");a&&r(JSON.parse(a))},[]),t.useEffect(()=>{s?(localStorage.setItem("authUser",JSON.stringify(s)),s.username===i&&(r(!0),localStorage.setItem("isAdmin",JSON.stringify(!0)))):(localStorage.removeItem("authUser"),localStorage.removeItem("isAdmin"))},[s]);let l=0;t.useEffect(()=>{!u&&l===1&&(A("/signin"),l++)},[u]);const h=()=>{try{localStorage.removeItem("authUser"),localStorage.removeItem("isAdmin"),r(!1),window.location.reload()}catch(e){console.error(e)}},S=async(e,a)=>{try{if(e===i&&a===N)return c({username:i,fullName:"Admin"}),r(!0),!0;{const n=await w(),m=(await window.ethereum.request({method:"eth_requestAccounts"}))[0];await n.methods.authenticateVoter().send({from:m});const d=await n.methods.getVoter(m).call();return c({username:d[0],fullName:d[0]}),r(!1),!0}}catch(n){return console.error(n),!1}};return I.jsx(f.Provider,{value:{user:s,isAuthenticated:u,isAdmin:g,login:S,logout:h},children:o})},O=()=>{const o=t.useContext(f);if(!o)throw new Error("useAuth must be used within an AuthProvider");return o};export{U as A,O as u};
